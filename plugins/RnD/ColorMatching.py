""" Color matching plugin for ENLIGHTEN

    Allows the user to convert a visible spectrum into a color measurement

"""

import logging
import colour
import numpy as np
from EnlightenPlugin import EnlightenPluginBase
import textwrap
COLOR_PLUGIN_VERSION = "1.0.0"
log = logging.getLogger(__name__)

# Calibration for WP-00853 to yield flat spectral response
# This factor is generated by measuring a broadband light source
# with known spectral distribution and computed as follows:
# calibration_factor = measured_spectrum / true_spectrum
# Where true_spectrum is the ground truth for the spectrum.
# This factor will eventually be stored in spectrometer EEPROM, but
# is temporarily here for proof-of-concept purposes.

SPECTROMETER_CALIBRATION_FACTOR=[
65.48573141832215,
64.35944916921166,
62.05313114747805,
59.82349026411653,
59.695525554804874,
59.56516497520382,
58.43490683411545,
57.09652064535335,
56.0966039707963,
55.41245455269799,
55.07406270728888,
55.52796992167188,
56.02130193843949,
54.52105764726922,
53.107867046044646,
53.1680775235783,
53.679976974653606,
52.797887761917295,
50.71238961833378,
49.056581834160106,
48.146095128352414,
47.26964132151085,
46.94929933248912,
46.68514851098699,
46.013940179623795,
45.24880505131979,
44.43437794967077,
43.75979130828226,
43.090862553225165,
42.48357380293564,
41.90891673785777,
41.693780519310884,
41.5230101160634,
41.44504594383816,
41.492855631153176,
41.22496537988742,
40.5836406586592,
39.9142683757409,
39.126803323395926,
38.369430106222026,
38.1860710155072,
38.07262936453929,
38.05385242594301,
38.14343729538738,
38.11513337199164,
38.026801044611474,
37.91431517434785,
37.46596193217872,
37.004646649492734,
36.380336188368894,
35.73042627129186,
35.304650819456945,
35.17385533001091,
35.032867679298135,
34.792190975683454,
34.559599266786414,
34.45984232539109,
34.37169695467142,
34.438678741138276,
34.518061806400844,
34.54731524597029,
34.60371690484344,
34.58448120591621,
33.88560363816738,
33.17619029488823,
32.4565482794855,
31.864238944147804,
31.533874844892967,
31.480050095467227,
31.381711552634947,
30.88024618244272,
30.40264162504915,
30.345879574219953,
30.336816199967775,
29.994135932817628,
29.446883920829276,
29.000980575889038,
28.881272662868923,
28.734307047885547,
28.499006083560314,
28.238408967184533,
28.04110123768342,
27.84979135328874,
27.594016929339187,
27.17659450629594,
26.75830464392295,
26.477344038295037,
26.23058069397503,
25.963004614803047,
25.702452982359418,
25.419176720987696,
25.090136909160865,
24.839405727682365,
24.79229130004259,
24.752566938115507,
24.42658663133958,
24.05019758964326,
23.780309426343855,
23.721254302678748,
23.599113613256765,
23.323334446887966,
23.046450191269333,
22.819158983391596,
22.590173454503617,
22.456278075263363,
22.400098791579154,
22.288786169321654,
22.01667583063885,
21.744650117929194,
21.513092389886115,
21.2804922187835,
21.142734842761133,
21.09242053612609,
21.019713073101197,
20.777500682434024,
20.5387066021021,
20.34939546314693,
20.171655938786817,
19.97511073974029,
19.749404378549396,
19.56046025039635,
19.446332787203602,
19.316347923425372,
19.153296219886148,
18.99948488913952,
18.830843885129795,
18.67818679573201,
18.53252634562825,
18.395914389453498,
18.238904781018142,
18.032090474148816,
17.80557330786806,
17.733549701916573,
17.749381854364707,
17.702865073887256,
17.477006133053106,
17.240273116760886,
17.107481916095445,
17.00009039086704,
16.877242594581983,
16.73804291424402,
16.613948777032668,
16.486374214689768,
16.357845263292546,
16.31910144085941,
16.261189195657675,
16.149192746005834,
15.995610334217155,
15.861769079745995,
15.705702974100115,
15.56116341867267,
15.522951091459202,
15.507205270851845,
15.473612535828307,
15.35572816320354,
15.246339372674859,
15.188864024076631,
15.120496900366575,
15.026788906942691,
14.913246317781589,
14.808272127538713,
14.736047450975224,
14.66832251121299,
14.556770875142426,
14.431907103868562,
14.35988285297527,
14.291061065833874,
14.22507114871284,
14.166891974326154,
14.110305586781013,
14.04496169905611,
13.980271692880402,
13.905509281872925,
13.837826050865225,
13.75112382763912,
13.663406536478824,
13.577225411009191,
13.475846519671665,
13.360038651522697,
13.266322353111223,
13.200357199699276,
13.127890095929388,
13.027723923408674,
12.928075379462134,
12.837301855860998,
12.753050045040496,
12.68000144187523,
12.627941159945136,
12.56867974992115,
12.462907236775004,
12.344172961367294,
12.271809784967559,
12.252436639712887,
12.24659946090095,
12.130592777765123,
11.997672978128437,
11.942856309022257,
11.936175986217219,
11.891223250976047,
11.786530017766376,
11.667617402906371,
11.61676834289754,
11.575064677184397,
11.517911211763169,
11.404868711890495,
11.311458503982069,
11.286406776346816,
11.245065280350982,
11.195713500797156,
11.131502561435106,
11.062797433686773,
11.00800635726109,
10.944346165977082,
10.87939808450519,
10.821876135454902,
10.775354903260856,
10.72948109613399,
10.690117119768106,
10.588747222749442,
10.489971716150757,
10.45226174239402,
10.463416692955663,
10.45522548131286,
10.3342686643051,
10.221487538550713,
10.16983420171869,
10.144750864516,
10.098926065531007,
10.018370162763196,
9.93564515814304,
9.890038838956677,
9.836172422437938,
9.77988985511009,
9.724665787871778,
9.673998354923244,
9.667174319923035,
9.646740640560463,
9.592758210831686,
9.515071516792,
9.456705535461303,
9.425265911574602,
9.387393277706247,
9.346822060824287,
9.293984914529345,
9.25631546642248,
9.219202355499982,
9.191259385354275,
9.141683761986576,
9.09816763864764,
9.067524297716385,
9.035820211872402,
9.006593320321251,
8.962082607944104,
8.922990454230897,
8.889859199943183,
8.839381307207091,
8.794803915445046,
8.762244773001285,
8.734014233543116,
8.687643565649214,
8.644404974115327,
8.602031776940946,
8.57396740849528,
8.540946851729705,
8.509766787022395,
8.47927190570819,
8.456877974377532,
8.436007345187242,
8.408182129788532,
8.371891800687912,
8.333638419781664,
8.303487815461725,
8.27731081771699,
8.261504759833867,
8.22266658083445,
8.195211395991207,
8.161468592442105,
8.124609736008544,
8.101977523072412,
8.071325278833127,
8.039921166195656,
8.008553141134504,
7.978426535543608,
7.945416963758916,
7.906374017619324,
7.862506007148564,
7.833802801167947,
7.8165887732478385,
7.787556208734365,
7.757723432105792,
7.729136751434686,
7.702561562440755,
7.6744758819072825,
7.6482825228598506,
7.630777797350571,
7.611111682386902,
7.584263390528741,
7.551232256568025,
7.510297692769027,
7.463467870782528,
7.423177772212516,
7.387683431664364,
7.354358287057731,
7.313638773309204,
7.285129871459442,
7.2569031175892125,
7.230563299591123,
7.2062906055838365,
7.170794087339623,
7.128167682424089,
7.081930375096736,
7.040305636506161,
7.005602666513345,
6.973185571894539,
6.945335351807392,
6.915371072249035,
6.873367422304941,
6.8385381199484865,
6.805982055882519,
6.775369772576374,
6.738601669193051,
6.700444594090407,
6.660433023820562,
6.631883032059431,
6.608848018237581,
6.578103353049679,
6.5507659171230275,
6.525280033881334,
6.497426960141278,
6.470025513927447,
6.438146289788563,
6.405870889711786,
6.373135049740522,
6.345831480773683,
6.319187041257976,
6.297863615414466,
6.276075573004675,
6.254489185122091,
6.237544666261953,
6.222536526791516,
6.196293729842444,
6.1726708671955315,
6.155836902176763,
6.136293142846061,
6.120228228312267,
6.104375264075934,
6.08591178856265,
6.060157538218579,
6.039602655434794,
6.0147743047146,
5.9832577626265975,
5.949497817047806,
5.92675656165957,
5.910975474433453,
5.889300570463301,
5.861097984677282,
5.834080986953561,
5.799370157494007,
5.7690720233847985,
5.739836102407365,
5.711243103412432,
5.684694812391284,
5.658968334292457,
5.62426911708749,
5.598735813525127,
5.564911101926121,
5.532209347632821,
5.506415094988884,
5.476881846903026,
5.449874160233331,
5.434723295675923,
5.420479753244389,
5.399800046637671,
5.385839999503526,
5.36541462983688,
5.34834888998414,
5.331171775739321,
5.314221497791573,
5.295273483371839,
5.280215767035301,
5.26254268891416,
5.245148918560895,
5.231722544660797,
5.216056781169048,
5.195879860169252,
5.176958791489403,
5.154166050722939,
5.132065330236298,
5.113184470878608,
5.096234807401177,
5.072766330304556,
5.0505622090578655,
5.035318543982815,
5.016498993389345,
4.999341915336299,
4.976695957391604,
4.954526916197154,
4.9331862220565865,
4.917985830615725,
4.902522496342874,
4.881406417134092,
4.861192489345117,
4.843658719505153,
4.830391494833998,
4.823126651288862,
4.81433058991491,
4.799826075794472,
4.787165118471701,
4.766823878500899,
4.7475042064899835,
4.725724254291853,
4.704761202679052,
4.684925011315135,
4.6650492123753375,
4.646865263038936,
4.626720936628265,
4.596425341707576,
4.569206715975396,
4.5422850013584535,
4.522043249839872,
4.496356037661532,
4.481517255655792,
4.466042086263382,
4.457955188863436,
4.450908730477817,
4.443193016698049,
4.430034962856934,
4.422490763155152,
4.416819455933926,
4.4067911138150455,
4.392126978309423,
4.377840585628529,
4.3657336259504484,
4.357849863520129,
4.350239483662571,
4.34174491649509,
4.32766260494289,
4.3090262223790115,
4.286115327451218,
4.261901669195907,
4.236328760189891,
4.213497974210145,
4.1929494327180175,
4.177187708110652,
4.16218314907192,
4.1505506226073745,
4.130959571090074,
4.1149317620847,
4.0989719790926085,
4.089577368606145,
4.080030798055655,
4.070341894074725,
4.059744374846641,
4.045135830434662,
4.025306134832248,
4.010909836466192,
3.9927431804821105,
3.978225300025673,
3.965249676654333,
3.9558785068575273,
3.949521246933333,
3.939850311102682,
3.9311738827743006,
3.921766156464905,
3.9147113724109643,
3.902763080237914,
3.884431495453767,
3.8653935318855295,
3.8475467226154887,
3.832646599862494,
3.8181834131014987,
3.8015090220023993,
3.787381219373307,
3.7764662602469787,
3.768996840308897,
3.7567818413928755,
3.750335710742076,
3.7381230585825906,
3.7303682263348885,
3.7205312321920028,
3.7106192284837936,
3.704275967131406,
3.6944547198924798,
3.678605013628551,
3.659458830949945,
3.6398944922177763,
3.628301600790636,
3.6204588034442424,
3.6100354662211225,
3.593594186523505,
3.582909343780495,
3.577747410911261,
3.5721203455974253,
3.5653011743297065,
3.5539746804014096,
3.545633945768216,
3.5307447817289446,
3.522702074752299,
3.521886083022007,
3.5237396665283223,
3.5281598561942653,
3.528912198322747,
3.5209124557584666,
3.5087162693202294,
3.4927214501670902,
3.475801630952624,
3.460765982350157,
3.437641628461218,
3.413666346376489,
3.3899778233501037,
3.368079580771556,
3.3472944820119466,
3.328379036774166,
3.314179449951083,
3.307692785975561,
3.303539968771224,
3.306969266729182,
3.3071447290649356,
3.3035637481686906,
3.296142811764997,
3.2770430955088843,
3.254210524424692,
3.239064642513035,
3.2235956815333076,
3.211019480546235,
3.2047918248132685,
3.2041647869668743,
3.1989094345576303,
3.188377376337108,
3.169840409328534,
3.1434340343977563,
3.123787945963036,
3.1172343791799864,
3.118704198848804,
3.1154932833046165,
3.099044559631026,
3.082462743308586,
3.0819791965016727,
3.0971186684495664,
3.11505699043127,
3.122502689525848,
3.115802378246583,
3.0988252775711813,
3.0817491755400312,
3.0678801458431364,
3.045762842012441,
3.035609380878853,
3.034566781560065,
3.041692855237422,
3.0572827076291618,
3.0643948829199155,
3.0463628006261887,
3.0342498414247427,
3.0072752406511674,
2.9716873737896643,
2.9473104391384983,
2.9373446648335517,
2.94297081200083,
2.952462700656833,
2.9524283269747884,
2.9423208469944826,
2.931174191943336,
2.9128474919909113,
2.889177997928906,
2.858731106436714,
2.834835812122118,
2.825853878041155,
2.8272698999702883,
2.8250608400611803,
2.816229538243129,
2.8002713183119456,
2.7834049375674157,
2.7724221621208347,
2.766617215477735,
2.7611936510622743,
2.7531285368788585,
2.745994133957532,
2.7393249678355356,
2.7416198658277673,
2.7446670252079204,
2.7581049120179726,
2.777534846388277,
2.7775796255072263,
2.7634020234472465,
2.744695904518108,
2.729859389100271,
2.711266708378305,
2.702471111608619,
2.7009614645458826,
2.6961446912096307,
2.677961357565061,
2.650904713847606,
2.6300144880159197,
2.6223850219614944,
2.622610696804907,
2.6272954378294044,
2.6419126136671545,
2.6447333301185574,
2.641796200448296,
2.637264582732034,
2.630993703116924,
2.6213331296015796,
2.606962768550324,
2.591395514116359,
2.5813889179660183,
2.5830789193193158,
2.5876546757844943,
2.5874491579149383,
2.5857389100165054,
2.5825378464351494,
2.5741803503684015,
2.562257004377962,
2.5558758418844922,
2.5514972699433716,
2.552408098211726,
2.5433619707081236,
2.5347377942478504,
2.525993703848954,
2.5191864326287425,
2.5192459356703845,
2.5202857233824987,
2.518935735693452,
2.5113565927460644,
2.4961063582220557,
2.4807802687608267,
2.470359586797318,
2.4663082124539923,
2.4665531787239754,
2.4658134487409327,
2.465138312885603,
2.459816364455709,
2.451657059221701,
2.446174308532527,
2.4424360871232405,
2.439121860039392,
2.435505469728266,
2.432285543001771,
2.4293177660802807,
2.430968387717002,
2.430363883610234,
2.4294456006147733,
2.4274427827962497,
2.422215738662317,
2.4149522356863242,
2.4076509574546505,
2.4033367341988834,
2.3979656228882833,
2.3919536225063722,
2.3875789356672135,
2.379130397254504,
2.3708264173986096,
2.3661501809853016,
2.358501111554638,
2.351291185490571,
2.3424283193190605,
2.341214769602916,
2.3413727695964903,
2.3399558025073284,
2.338897482370214,
2.338588071308636,
2.3365002248011573,
2.3358546134123634,
2.3358472250616975,
2.3306680537300704,
2.3235766127667037,
2.3167142410304904,
2.3081758818904077,
2.300001221747812,
2.293474718288753,
2.285700990676148,
2.276439821971285,
2.268747667398115,
2.2637649720333135,
2.2582875070398627,
2.255259344496919,
2.2511146012025485,
2.248001735867042,
2.2450889039364195,
2.2413649253214762,
2.236095455674934,
2.2320993412245227,
2.2274668895165566,
2.2217930656050267,
2.216928379128443,
2.209448846196368,
2.2011985099374374,
2.197912720597385,
2.1934791969856144,
2.189447629340396,
2.183801964343826,
2.179183099419187,
2.173861935655192,
2.167279816874898,
2.16091664202121,
2.1573627358901604,
2.151483245317182,
2.1453041765126835,
2.1397707171714297,
2.1338907339322555,
2.128239566272208,
2.123729808104557,
2.120287335046792,
2.115788545862644,
2.1102660091545027,
2.1019681788418256,
2.094846221656159,
2.0908641639119114,
2.086490124455975,
2.083067232110483,
2.0772763047922838,
2.0692132662615697,
2.0645808752791877,
2.062595073135405,
2.061400142498942,
2.0570363032251824,
2.051520820164096,
2.0489178495727667,
2.0474907891732537,
2.0475360798595803,
2.0441261197061245,
2.038311479938277,
2.0336465849058367,
2.030868613338473,
2.027108041612738,
2.020907838994342,
2.0157663548667957,
2.0124660602107314,
2.0059794392577825,
1.9997172208982792,
1.9967892957320084,
1.995849594370518,
1.9933571855255823,
1.9903266701464788,
1.986427060303371,
1.9825565192361867,
1.978727590734313,
1.976433112294884,
1.9723761274834473,
1.969426765180196,
1.9687107407005093,
1.9668724414646184,
1.964716583855853,
1.9619803585309288,
1.958856588349469,
1.9564358061094502,
1.952214833901997,
1.9473059256582945,
1.9437183706619672,
1.942319457773378,
1.943458107287884,
1.9429480403391308,
1.9391009383155784,
1.9359901669509834,
1.93417946583908,
1.934530382225218,
1.9299182035030125,
1.9270915267532258,
1.9205971849203893,
1.9160161503047282,
1.9117340899208755,
1.9089105579042722,
1.9054094995031146,
1.902283566354377,
1.8998564008097576,
1.8944777605386605,
1.891792573895766,
1.8878593744246335,
1.880762978433385,
1.8759272880956008,
1.874504244042097,
1.8711044340662495,
1.8701251408046855,
1.8680683919818182,
1.865379092801503,
1.8630148976503245,
1.8636987598985018,
1.861970202813189,
1.8615009074589957,
1.8594946126747096,
1.8566383079157704,
1.8556142612744664,
1.8542303826179083,
1.8513938121693847,
1.8465572354194522,
1.8433965386877236,
1.8407684342328092,
1.8374556744880028,
1.834754843279064,
1.8320222441388625,
1.8299254648725694,
1.8276231506644491,
1.8260818033586648,
1.8242323076401674,
1.8222735913673331,
1.8193173247615888,
1.8183814007797605,
1.8166023934567213,
1.8140097257483938,
1.80972948243546,
1.805895736477832,
1.8023056033641511,
1.798740886455431,
1.7968558376774562,
1.7929806645316515,
1.790672791800546,
1.7875974711840974,
1.784527018306923,
1.7826206207727147,
1.7791590249309286,
1.7749380172081117,
1.7716091636442655,
1.76920660161995,
1.7683157841484227,
1.7684702048700898,
1.7650058571852072,
1.763924052907428,
1.7639317115452293,
1.7610239276188036,
1.7572249886908382,
1.7538003210656614,
1.7495579527459042,
1.7472160653338298,
1.7439616533039395,
1.741076569989778,
1.7388686427649915,
1.7357524311222416,
1.7337241847085076,
1.729733958344343,
1.7272908484049947,
1.7263751655564918,
1.7247908058907737,
1.7235460359505625,
1.717875146025108,
1.7148333999793697,
1.7097011528419026,
1.7075201881795028,
1.706290176619333,
1.7017729403081685,
1.6977855589593247,
1.693348743030256,
1.6888699003186398,
1.6840491876211867,
1.68061738549268,
1.679530935905512,
1.6786002489756595,
1.6749927761093677,
1.6710425605557773,
1.6664752760013837,
1.663171607939686,
1.6595353943379658,
1.6562735272374762,
1.6528158696237054,
1.6484073084873392,
1.6419570654058595,
1.6352374796065936,
1.6321739274044196,
1.6289449167707395,
1.6256739273230691,
1.6226403105583997,
1.6212106681281264,
1.6194379655422315,
1.6160226350343674,
1.614275218793525,
1.6099985753793409,
1.6054864362906849,
1.6003399552353135,
1.599363023566355,
1.597189741390396,
1.5934140071249303,
1.5900905949468829,
1.5857876852355504,
1.5819994713961294,
1.5791639648466946,
1.5753638071633245,
1.573367480849718,
1.5686782171662528,
1.5640303456392992,
1.56071634909173,
1.5581765184502236,
1.5538365128053875,
1.548447891521716,
1.5452262414302806,
1.541238999969357,
1.5392671310667512,
1.5357418377273633,
1.5298338411253134,
1.525057498762237,
1.520050293489224,
1.5148610300512493,
1.5092616719466734,
1.502158119852904,
1.4975861538273614,
1.4926991403548646,
1.4881787007634568,
1.482539146802317,
1.4759161047179394,
1.4694597406774133,
1.4640745308619767,
1.4600259007308556,
1.4551554904419473,
1.4487699130674183,
1.4429454422088765,
1.4356626609467742,
1.4283135748479714,
1.4221174206706533,
1.419088123941108,
1.4151713096601313,
1.4104479227564815,
1.4067959767890836,
1.4014983138828738,
1.395993977947625,
1.389172656234708,
1.3843633987559076,
1.3822994163135525,
1.380050005073384,
1.3751007814080232,
1.3698199160412685,
1.3640398945807293,
1.3605436252334573,
1.3581173312519927,
1.3544017329241291,
1.3511295028754058,
1.3465049081285416,
1.340691515616876,
1.3356299458326444,
1.3295617992959077,
1.3242991054105424,
1.3200322834911262,
1.3140546070289025,
1.3071294971525622,
1.3015762174900993,
1.2975397026719684,
1.2934101921406413,
1.2886980785981745,
1.2815329778533298,
1.2734617985706767,
1.2672495792301905,
1.262931337395203,
1.259342189598978,
1.2541017333242235,
1.2498233752050452,
1.244333501162457,
1.2380405990846748,
1.2336646582295137,
1.2285778331609305,
1.2236890494328747,
1.2189851928081863,
1.2148886487089845,
1.2100926055932593,
1.2061927872808689,
1.2012160148978583,
1.1966270196928963,
1.1934182112927403,
1.1894843871161496,
1.18691129180388,
1.1817266109898317,
1.1771971151932985,
1.171951828608877,
1.1687693899168676,
1.1653828661634056,
1.1604564715871872,
1.1548246709644936,
1.149074358917443,
1.1449900200144665,
1.1411367431756856,
1.137165339120491,
1.1334915035920181,
1.1295277881013972,
1.1236953226007347,
1.117965017127736,
1.1139606116762628,
1.1094983984052793,
1.1057409663557298,
1.1004019324718592,
1.0955315423518355,
1.0908357175119239,
1.0867681742474617,
1.083122871200466,
1.0803253835179827,
1.0758685220581483,
1.072356266518207,
1.068748191916973,
1.0662567091794002,
1.0617036629873295,
1.0575073917563091,
1.0530128051819863,
1.0515231246620327,
1.0476167496599287,
1.0424254862532176,
1.0370809071509972,
1.0323910890637593,
1.0275159450764026,
1.0236921175914593,
1.0186568605893738,
1.0139075888384232,
1.009764023356815,
1.0047800783549203,
1.0004232702016043,
0.9971810499390729,
0.9937981609657843,
0.9904688959515542,
0.9877438709970183,
0.9844661017971743,
0.9814705627505018,
0.9790350032025117,
0.9748246503023107,
0.9699679481860232,
0.9653797146884857,
0.9610494990987312,
0.9577422129174501,
0.9550275898592997,
0.9537206700881192,
0.9497303904062503,
0.9442702682104231,
0.9412257015518758,
0.938391189457947,
0.9357202016619977,
0.9326190350739556,
0.9300196714424732,
0.927444559208246,
0.9252602575622887,
0.9229621052048547,
0.9171357616783294,
0.9120024753827068,
]

# Corresponding wavelengths for SPECTROMETER_CALIBRATION_FACTOR
# Allows calibration to be interpolated over different wavelength
# ranges, which will occur when the spectra is altered (cropped,
# interpolated, ect.)
SPECTROMETER_CALIBRATION_WAVELENGTHS=[
372.6589050292969,
373.1050050240266,
373.5509427297518,
373.9967183524627,
374.44233209814956,
374.8877841728024,
375.33307478241136,
375.7782041329666,
376.22317243045836,
376.6679798808767,
377.11262669021175,
377.5571130644537,
378.0014392095927,
378.44560533161894,
378.88961163652243,
379.3334583302934,
379.7771456189221,
380.2206737083985,
380.66404280471284,
381.1072531138552,
381.5503048418159,
381.9931981945849,
382.4359333781524,
382.87851059850857,
383.3209300616436,
383.7631919735476,
384.2052965402106,
384.6472439676229,
385.08903446177465,
385.53066822865594,
385.9721454742569,
386.41346640456766,
386.8546312255785,
387.29564014327946,
387.73649336366066,
388.1771910927123,
388.61773353642457,
389.05812090078757,
389.4983533917914,
389.93843121542625,
390.37835457768233,
390.81812368454973,
391.25773874201855,
391.697199956079,
392.1365075327212,
392.5756616779354,
393.01466259771155,
393.4535104980399,
393.8922055849107,
394.330748064314,
394.76913814223985,
395.2073760246785,
395.6454619176202,
396.08339602705496,
396.5211785589729,
396.95880971936424,
397.39628971421917,
397.8336187495278,
398.27079703128015,
398.7078247654665,
399.14470215807705,
399.58142941510187,
400.01800674253104,
400.4544343463548,
400.8907124325633,
401.3268412071467,
401.762820876095,
402.1986516453985,
402.63433372104737,
403.0698673090317,
403.50525261534153,
403.94048984596714,
404.3755792068987,
404.8105209041263,
405.24531514364,
405.6799621314301,
406.1144620734867,
406.5488151758,
406.98302164435995,
407.41708168515686,
407.8509955041809,
408.28476330742217,
408.71838530087075,
409.15186169051685,
409.5851926823507,
410.0183784823623,
410.45141929654187,
410.88431533087953,
411.3170667913655,
411.7496738839899,
412.18213681474276,
412.61445578961434,
413.0466310145948,
413.4786626956743,
413.91055103884287,
414.3422962500907,
414.7738985354081,
415.205358100785,
415.63667515221164,
416.06784989567814,
416.4988825371747,
416.9297732826915,
417.3605223382185,
417.791129909746,
418.2215962032642,
418.65192142476315,
419.08210578023295,
419.5121494756638,
419.94205271704595,
420.37181571036945,
420.8014386616244,
421.230921776801,
421.66026526188944,
422.08946932287984,
422.5185341657623,
422.94745999652696,
423.3762470211641,
423.80489544566376,
424.23340547601606,
424.6617773182112,
425.09001117823937,
425.51810726209067,
425.9460657757552,
426.37388692522313,
426.8015709164847,
427.22911795553,
427.6565282483491,
428.0838020009322,
428.51093941926956,
428.9379407093512,
429.36480607716726,
429.7915357287079,
430.2181298699634,
430.64458870692374,
431.0709124455791,
431.49710129191965,
431.9231554519356,
432.34907513161704,
432.77486053695407,
433.2005118739369,
433.6260293485557,
434.05141316680056,
434.4766635346616,
434.90178065812904,
435.32676474319305,
435.75161599584374,
436.1763346220712,
436.6009208278656,
437.0253748192172,
437.449696802116,
437.8738869825522,
438.297945566516,
438.7218727599975,
439.14566876898687,
439.5693337994742,
439.99286805744964,
440.41627174890345,
440.8395450798257,
441.2626882562065,
441.68570148403603,
442.1085849693045,
442.531338918002,
442.95396353611864,
443.3764590296446,
443.7988256045701,
444.2210634668852,
444.64317282258,
445.0651538776448,
445.48700683806965,
445.90873190984473,
446.3303292989601,
446.751799211406,
447.17314185317264,
447.59435743025006,
448.01544614862837,
448.4364082142978,
448.8572438332485,
449.2779532114706,
449.6985365549542,
450.1189940696895,
450.5393259616667,
450.95953243687586,
451.3796137013071,
451.79956996095063,
452.21940142179665,
452.63910828983524,
453.0586907710565,
453.4781490714506,
453.8974833970078,
454.3166939537182,
454.7357809475718,
455.1547445845589,
455.57358507066965,
455.99230261189416,
456.4108974142225,
456.8293696836449,
457.2477196261516,
457.6659474477326,
458.08405335437806,
458.50203755207815,
458.9199002468231,
459.33764164460297,
459.7552619514079,
460.172761373228,
460.5901401160536,
461.0073983858747,
461.4245363886814,
461.84155433046396,
462.25845241721254,
462.67523085491723,
463.09188984956813,
463.50842960715545,
463.9248503336694,
464.3411522351,
464.75733551743747,
465.1734003866719,
465.58934704879357,
466.0051757097925,
466.42088657565887,
466.8364798523828,
467.25195574595455,
467.6673144623642,
468.0825562076018,
468.4976811876576,
468.91268960852176,
469.3275816761844,
469.74235759663566,
470.15701757586567,
470.57156181986466,
470.9859905346227,
471.40030392612994,
471.8145022003765,
472.2285855633527,
472.6425542210485,
473.05640837945407,
473.4701482445596,
473.8837740223553,
474.2972859188312,
474.7106841399775,
475.12396889178433,
475.5371403802419,
475.95019881134033,
476.3631443910697,
476.7759773254202,
477.188697820382,
477.60130608194527,
478.01380231610005,
478.42618672883657,
478.838459526145,
479.2506209140155,
479.66267109843807,
480.07461028540297,
480.4864386809004,
480.8981564909204,
481.30976392145317,
481.7212611784888,
482.1326484680176,
482.54392599602954,
482.9550939685148,
483.36615259146356,
483.777102070866,
484.1879426127123,
484.5986744229924,
485.00929770769665,
485.41981267281517,
485.8302195243381,
486.24051846825546,
486.6507097105575,
487.06079345723447,
487.4707699142764,
487.8806392876734,
488.29040178341563,
488.70005760749336,
489.10960696589666,
489.5190500646156,
489.9283871096404,
490.3376183069613,
490.74674386256834,
491.1557639824516,
491.56467887260135,
491.97348873900773,
492.38219378766087,
492.79079422455084,
493.19929025566785,
493.6076820870021,
494.0159699245437,
494.4241539742827,
494.83223444220937,
495.24021153431386,
495.6480854565863,
496.0558564150167,
496.46352461559536,
496.87109026431244,
497.27855356715804,
497.68591473012225,
498.09317395919527,
498.5003314603673,
498.90738743962845,
499.3143421029688,
499.72119565637854,
500.1279483058479,
500.53460025736695,
500.9411517169258,
501.3476028905146,
501.75395398412365,
502.160205203743,
502.5663567553627,
502.97240884497296,
503.37836167856403,
503.784215462126,
504.1899704016489,
504.595626703123,
505.0011845725385,
505.4066442158854,
505.8120058391539,
506.2172696483342,
506.62243584941643,
507.02750464839073,
507.4324762512472,
507.837350863976,
508.24212869256735,
508.64680994301136,
509.0513948212981,
509.4558835334178,
509.86027628536067,
510.26457328311676,
510.6687747326762,
511.07288084002914,
511.47689181116584,
511.8808078520764,
512.2846291687508,
512.6883559671794,
513.0919884533523,
513.4955268332596,
513.8989713128915,
514.302322098238,
514.7055793952895,
515.108743410036,
515.5118143484676,
515.9147924165745,
516.317677820347,
516.720470765775,
517.1231714588487,
517.5257801055583,
517.928296911894,
518.3307220838459,
518.7330558274041,
519.1352983485588,
519.5374498533001,
519.9395105476183,
520.3414806375033,
520.7433603289454,
521.1451498279348,
521.5468493404616,
521.9484590725158,
522.3499792300877,
522.7514100191675,
523.1527516457452,
523.554004315811,
523.955168235355,
524.3562436103675,
524.7572306468386,
525.1581295507583,
525.5589405281169,
525.9596637849045,
526.3602995271112,
526.7608479607272,
527.1613092917427,
527.5616837261477,
527.9619714699326,
528.3621727290872,
528.7622877096019,
529.1623166174668,
529.562259658672,
529.9621170392077,
530.3618889650639,
530.761575642231,
531.161177276699,
531.5606940744581,
531.9601262414983,
532.35947398381,
532.7587375073831,
533.1579170182079,
533.5570127222744,
533.956024825573,
534.3549535340936,
534.7537990538265,
535.1525615907617,
535.5512413508895,
535.9498385402001,
536.3483533646834,
536.7467860303296,
537.1451367431291,
537.5434057090719,
537.941593134148,
538.3396992243477,
538.7377241856611,
539.1356682240785,
539.5335315455898,
539.9313143561852,
540.329016861855,
540.7266392685893,
541.1241817823782,
541.5216446092118,
541.9190279550803,
542.3163320259739,
542.7135570278826,
543.1107031667967,
543.5077706487064,
543.9047596796016,
544.3016704654726,
544.6985032123096,
545.0952581261026,
545.4919354128419,
545.8885352785176,
546.2850579291197,
546.6815035706386,
547.0778724090643,
547.4741646503869,
547.8703805005966,
548.2665201656837,
548.6625838516381,
549.0585717644501,
549.4544841101098,
549.8503210946074,
550.2460829239329,
550.6417698040766,
551.0373819410286,
551.432919540779,
551.8283828093181,
552.2237719526358,
552.6190871767225,
553.0143286875682,
553.4094966911631,
553.8045913934973,
554.1996130005609,
554.5945617183443,
554.9894377528374,
555.3842413100303,
555.7789725959134,
556.1736318164767,
556.5682191777104,
556.9627348856045,
557.3571791461493,
557.7515521653349,
558.1458541491515,
558.5400853035892,
558.9342458346381,
559.3283359482884,
559.7223558505303,
560.1163057473539,
560.5101858447492,
560.9039963487066,
561.2977374652162,
561.691409400268,
562.0850123598522,
562.478546549959,
562.8720121765786,
563.2654094457009,
563.6587385633163,
564.0519997354149,
564.4451931679869,
564.8383190670222,
565.2313776385112,
565.6243690884439,
566.0172936228106,
566.4101514476013,
566.8029427688061,
567.1956677924154,
567.5883267244192,
567.9809197708075,
568.3734471375707,
568.7659090306988,
569.158305656182,
569.5506372200105,
569.9429039281742,
570.3351059866636,
570.7272436014687,
571.1193169785795,
571.5113263239863,
571.9032718436792,
572.2951537436485,
572.6869722298841,
573.0787275083762,
573.4704197851152,
573.8620492660909,
574.2536161572937,
574.6451206647135,
575.0365629943408,
575.4279433521655,
575.8192619441777,
576.2105189763677,
576.6017146547256,
576.9928491852415,
577.3839227739056,
577.774935626708,
578.165887949639,
578.5567799486886,
578.9476118298469,
579.3383837991041,
579.7290960624505,
580.1197488258761,
580.510342295371,
580.9008766769253,
581.2913521765295,
581.6817690001734,
582.0721273538472,
582.4624274435412,
582.8526694752454,
583.2428536549501,
583.6329801886452,
584.023049282321,
584.4130611419678,
584.8030159735755,
585.1929139831343,
585.5827553766344,
585.972540360066,
586.3622691394191,
586.751941920684,
587.1415589098507,
587.5311203129095,
587.9206263358504,
588.3100771846637,
588.6994730653394,
589.0888141838677,
589.4781007462389,
589.8673329584428,
590.2565110264699,
590.6456351563102,
591.0347055539538,
591.4237224253909,
591.8126859766116,
592.2015964136062,
592.5904539423648,
592.9792587688773,
593.3680110991342,
593.7567111391254,
594.1453590948412,
594.5339551722716,
594.9224995774068,
595.3109925162371,
595.6994341947525,
596.0878248189431,
596.4761645947991,
596.8644537283108,
597.2526924254681,
597.6408808922613,
598.0290193346805,
598.4171079587159,
598.8051469703576,
599.1931365755956,
599.5810769804203,
599.9689683908218,
600.3568110127902,
600.7446050523156,
601.1323507153882,
601.5200482079981,
601.9076977361356,
602.2952995057906,
602.6828537229534,
603.0703605936142,
603.457820323763,
603.8452331193901,
604.2325991864855,
604.6199187310394,
605.0071919590421,
605.3944190764835,
605.7816002893538,
606.1687358036434,
606.5558258253421,
606.9428705604403,
607.329870214928,
607.7168249947954,
608.1037351060327,
608.4906007546299,
608.8774221465773,
609.264199487865,
609.6509329844831,
610.0376228424218,
610.4242692676712,
610.8108724662216,
611.1974326440629,
611.5839500071854,
611.9704247615792,
612.3568571132346,
612.7432472681415,
613.1295954322902,
613.5159018116708,
613.9021666122735,
614.2883900400884,
614.6745723011056,
615.0607136013153,
615.4468141467078,
615.832874143273,
616.2188937970011,
616.6048733138823,
616.9908128999068,
617.3767127610647,
617.7625731033461,
618.1483941327411,
618.5341760552401,
618.919919076833,
619.30562340351,
619.6912892412613,
620.0769167960771,
620.4625062739474,
620.8480578808624,
621.2335718228122,
621.6190483057871,
622.0044875357772,
622.3898897187726,
622.7752550607634,
623.1605837677398,
623.545876045692,
623.9311321006101,
624.3163521384841,
624.7015363653045,
625.0866849870612,
625.4717982097443,
625.856876239344,
626.2419192818506,
626.6269275432542,
627.0119012295447,
627.3968405467125,
627.7817457007477,
628.1666168976404,
628.5514543433808,
628.936258243959,
629.3210288053651,
629.7057662335894,
630.0904707346219,
630.4751425144528,
630.8597817790724,
631.2443887344706,
631.6289635866376,
632.0135065415636,
632.3980178052389,
632.7824975836534,
633.1669460827973,
633.5513635086608,
633.935750067234,
634.3201059645072,
634.7044314064703,
635.0887265991137,
635.4729917484274,
635.8572270604016,
636.2414327410263,
636.6256089962918,
637.0097560321883,
637.3938740547059,
637.7779632698346,
638.1620238835646,
638.5460561018863,
638.9300601307896,
639.3140361762646,
639.6979844443016,
640.0819051408907,
640.4657984720221,
640.8496646436859,
641.2335038618721,
641.6173163325711,
642.001102261773,
642.3848618554678,
642.7685953196457,
643.1523028602969,
643.5359846834116,
643.9196409949798,
644.3032720009917,
644.6868779074375,
645.0704589203074,
645.4540152455913,
645.8375470892796,
646.2210546573624,
646.6045381558298,
646.9879977906719,
647.3714337678789,
647.754846293441,
648.1382355733483,
648.5216018135909,
648.904945220159,
649.2882659990428,
649.6715643562324,
650.0548404977178,
650.4380946294893,
650.8213269575372,
651.2045376878514,
651.587727026422,
651.9708951792394,
652.3540423522936,
652.7371687515748,
653.1202745830731,
653.5033600527786,
653.8864253666816,
654.2694707307721,
654.6524963510403,
655.0355024334764,
655.4184891840705,
655.8014568088128,
656.1844055136933,
656.5673355047022,
656.9502469878298,
657.3331401690662,
657.7160152544013,
658.0988724498255,
658.481711961329,
658.8645339949018,
659.247338756534,
659.6301264522158,
660.0128972879374,
660.395651469689,
660.7783892034606,
661.1611106952424,
661.5438161510247,
661.9265057767974,
662.3091797785507,
662.6918383622749,
663.07448173396,
663.4571100995963,
663.8397236651738,
664.2223226366826,
664.6049072201131,
664.9874776214552,
665.3700340466992,
665.7525767018351,
666.1351057928532,
666.5176215257436,
666.9001241064964,
667.2826137411017,
667.6650906355499,
668.0475549958309,
668.4300070279348,
668.812446937852,
669.1948749315725,
669.5772912150865,
669.959695994384,
670.3420894754553,
670.7244718642905,
671.1068433668798,
671.4892041892133,
671.8715545372811,
672.2538946170735,
672.6362246345805,
673.0185447957922,
673.4008553066989,
673.7831563732907,
674.1654482015578,
674.5477309974901,
674.930004967078,
675.3122703163117,
675.6945272511812,
676.0767759776766,
676.4590167017881,
676.8412496295059,
677.2234749668202,
677.6056929197209,
677.9879036941984,
678.3701074962428,
678.7523045318442,
679.1344950069927,
679.5166791276785,
679.8988570998918,
680.2810291296227,
680.6631954228612,
681.0453561855977,
681.4275116238223,
681.809661943525,
682.1918073506961,
682.5739480513256,
682.9560842514038,
683.3382161569208,
683.7203439738666,
684.1024679082316,
684.4845881660058,
684.8667049531794,
685.2488184757424,
685.6309289396851,
686.0130365509976,
686.3951415156702,
686.7772440396927,
687.1593443290556,
687.5414425897488,
687.9235390277627,
688.3056338490871,
688.6877272597125,
689.0698194656288,
689.4519106728263,
689.8340010872951,
690.2160909150252,
690.598180362007,
690.9802696342306,
691.3623589376859,
691.7444484783633,
692.1265384622529,
692.5086290953449,
692.8907205836292,
693.2728131330962,
693.654906949736,
694.0370022395387,
694.4190992084943,
694.8011980625932,
695.1832990078256,
695.5654022501814,
695.9475079956508,
696.329616450224,
696.7117278198912,
697.0938423106425,
697.4759601284679,
697.8580814793578,
698.2402065693022,
698.6223356042914,
699.0044687903153,
699.3866063333642,
699.7687484394282,
700.1508953144976,
700.5330471645623,
700.9152041956125,
701.2973666136386,
701.6795346246305,
702.0617084345783,
702.4438882494724,
702.8260742753027,
703.2082667180596,
703.590465783733,
703.9726716783131,
704.3548846077902,
704.7371047781543,
705.1193323953955,
705.5015676655041,
705.8838107944703,
706.266061988284,
706.6483214529355,
707.030589394415,
707.4128660187125,
707.7951515318183,
708.1774461397224,
708.559750048415,
708.9420634638864,
709.3243865921265,
709.7067196391256,
710.0890628108738,
710.4714163133613,
710.8537803525782,
711.2361551345145,
711.6185408651606,
712.0009377505066,
712.3833459965426,
712.7657658092587,
713.1481973946451,
713.530640958692,
713.9130967073894,
714.2955648467275,
714.6780455826965,
715.0605391212866,
715.4430456684879,
715.8255654302905,
716.2080986126845,
716.5906454216602,
716.9732060632076,
717.3557807433169,
717.7383696679783,
718.120973043182,
718.503591074918,
718.8862239691764,
719.2688719319475,
719.6515351692215,
720.0342138869884,
720.4169082912383,
720.7996185879615,
721.1823449831481,
721.5650876827883,
721.9478468928721,
722.3306228193898,
722.7134156683314,
723.0962256456872,
723.4790529574473,
723.8618978096017,
724.2447604081408,
724.6276409590546,
725.0105396683332,
725.3934567419668,
725.7763923859457,
726.1593468062598,
726.5423202088994,
726.9253127998545,
727.3083247851155,
727.6913563706723,
728.0744077625152,
728.4574791666342,
728.8405707890197,
729.2236828356616,
729.6068155125502,
729.9899690256755,
730.3731435810278,
730.7563393845971,
731.1395566423737,
731.5227955603476,
731.9060563445091,
732.2893392008483,
732.6726443353552,
733.0559719540202,
733.4393222628332,
733.8226954677846,
734.2060917748643,
734.5895113900625,
734.9729545193695,
735.3564213687754,
735.7399121442702,
736.1234270518441,
736.5069662974875,
736.8905300871902,
737.2741186269425,
737.6577321227345,
738.0413707805565,
738.4250348063985,
738.8087244062506,
739.192439786103,
739.576181151946,
739.9599487097696,
740.3437426655639,
740.7275632253192,
741.1114105950255,
741.4952849806731,
741.879186588252,
742.2631156237524,
742.6470722931645,
743.0310568024784,
743.4150693576842,
743.7991101647721,
744.1831794297323,
744.5672773585549,
744.95140415723,
745.3355600317477,
745.7197451880984,
746.103959832272,
746.4882041702588,
746.8724784080488,
747.2567827516323,
747.6411174069993,
748.0254825801401,
748.4098784770447,
748.7943053037034,
749.1787632661062,
749.5632525702433,
749.9477734221049,
750.3323260276811,
750.7169105929621,
751.101527323938,
751.4861764265988,
751.870858106935,
752.2555725709365,
752.6403200245934,
753.025100673896,
753.4099147248344,
753.7947623833987,
754.1796438555791,
754.5645593473657,
754.9495090647488,
755.3344932137184,
755.7195120002646,
756.1045656303776,
756.4896543100476,
756.8747782452648,
757.2599376420192,
757.645132706301,
758.0303636441004,
758.4156306614075,
758.8009339642124,
759.1862737585053,
759.5716502502764,
759.9570636455159,
760.3425141502137,
760.7280019703601,
761.1135273119453,
761.4990903809594,
761.8846913833925,
762.2703305252347,
762.6560080124764,
763.0417240511075,
763.4274788471182,
763.8132726064987,
764.1991055352391,
764.5849778393297,
764.9708897247604,
765.3568413975214,
765.742833063603,
766.1288649289953,
766.5149371996883,
766.9010500816723,
767.2872037809375,
767.6733985034739,
768.0596344552716,
768.4459118423209,
768.832230870612,
769.2185917461348,
769.6049946748797,
769.9914398628366,
770.3779275159959,
770.7644578403476,
771.1510310418819,
771.5376473265889,
771.9243069004588,
772.3110099694817,
772.6977567396477,
773.0845474169471,
773.47138220737,
773.8582613169065,
774.2451849515467,
774.6321533172808,
775.019166620099,
775.4062250659914,
775.7933288609481,
776.1804782109593,
776.5676733220153,
776.954914400106,
777.3422016512216,
777.7295352813522,
778.1169154964882,
778.5043425026196,
778.8918165057364,
779.2793377118289,
779.6669063268873,
780.0545225569017,
780.4421866078621,
780.8298986857588,
]

COLOR_MODEL_ALIASES = {
                        'CIE 1931 2 deg' : 'CIE 1931 2 Degree Standard Observer',
                        'CIE 1931 10 deg' : 'CIE 1964 10 Degree Standard Observer',
                        'CIE 2015 2 deg' : 'CIE 2015 2 Degree Standard Observer',
                        'CIE 2015 10 deg' : 'CIE 2015 10 Degree Standard Observer'
}

class ColorMatching(EnlightenPluginBase):

        def disconnect(self):
            super().disconnect()

        def get_configuration(self):

            self.name = f"ColorMatching {COLOR_PLUGIN_VERSION}"
            self.has_other_graph = False
            self.auto_enable = True
            self.is_blocking = True
            self.block_enlighten = False

            self.field(
                name="Color Model",
                datatype="combobox",
                direction="input",
                choices=list(COLOR_MODEL_ALIASES.keys()),
                tooltip="Color model to use",
            )

            self.field(
                name="XYZ",
                datatype=str,
                direction="output",
                tooltip="XYZ",
            )

            self.field(
                name="RGB",
                datatype=str,
                direction="output",
                tooltip="RGB",
            )

            self.field(
                name="sRGB",
                datatype=str,
                direction="output",
                tooltip="sRGB",
            )

            self.field(
                name="Color Temp",
                datatype=str,
                direction="output",
                tooltip="Color temperature",
            )

            self.field(name="Apply Calibration",
                       direction="input",
                       datatype=bool,
                       initial=True,
                       expert=False,
                       tooltip="Apply hard coded (relative) spectral intensity calibration")

            log.debug(f"{self.name} started")

        def process_request(self, request):
            """ Process new spectrum received from ENLIGHTEN

                Spectra are divided by a hard-coded calibration factor (if enabled) to give a flat spectral response,
                interpolated to 1 nm wavelength spacing (necessary for the color-science package), then converted
                into CIE XYZ tristimulus values.

                CIE XYZ is the necessary basis for conversion to other colorspaces.

                The function demonstrates conversion to sRGB, RGB and color temperature.

            """
            wavelength = np.array(request.processed_reading.get_wavelengths(), dtype=np.float64)
            spectrum = np.array(request.processed_reading.get_processed(), dtype=np.float64)

            colorspace_alias = request.fields["Color Model"]
            colorspace_model = COLOR_MODEL_ALIASES[colorspace_alias]
            apply_calibration = request.fields["Apply Calibration"]

            if apply_calibration:

                calibration_factor = np.interp(wavelength, SPECTROMETER_CALIBRATION_WAVELENGTHS, SPECTROMETER_CALIBRATION_FACTOR)

                spectrum = spectrum / calibration_factor

            wavelength_interp = np.arange(int(min(wavelength)), int(max(wavelength))+1, 1)
            spectral_interp = np.interp(wavelength_interp, wavelength,spectrum)

            spectral_data = {w: c for w, c in zip(wavelength_interp, spectral_interp)}

            sd = colour.SpectralDistribution(spectral_data)
            cmfs = colour.MSDS_CMFS[colorspace_model]

            XYZ = colour.sd_to_XYZ(sd, cmfs)

            RGB = colour.XYZ_to_RGB(XYZ, 'CIE RGB')
            sRGB = colour.XYZ_to_sRGB(XYZ)
            xy = colour.XYZ_to_xy(XYZ)
            cct = colour.xy_to_CCT(xy)

            XYZ_n = (XYZ/max(XYZ))
            RGB_n = (RGB/max(RGB))*100
            sRGB_n = (sRGB/max(sRGB))*255

            self.outputs = {
                "XYZ": f"{XYZ_n[0]:.2f}, {XYZ_n[1]:.2f}, {XYZ_n[2]:.2f}",
                "RGB": f"{RGB_n[0]:.2f}, {RGB_n[1]:.2f}, {RGB_n[2]:.2f}",
                "sRGB": f"{sRGB_n[0]:.2f}, {sRGB_n[1]:.2f}, {sRGB_n[2]:.2f}",
                "Color Temp": f"{cct:.1f} K"
            }

            if apply_calibration:
                self.plot(x=wavelength_interp,
                          y=spectral_interp,
                          title=f"Calibrated",
                          color='#2994d3')